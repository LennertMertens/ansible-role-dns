# roles/dns/tasks/main.yml
---

- include_vars: "{{ item }}"
  with_first_found:
    - "{{ ansible_distribution }}.yml"
  tags: 
    - dns


- name: Disable PEERDNS
  lineinfile:
    path: "/etc/sysconfig/network-scripts/ifcfg-{{ dns_intname }}"
    line: "PEERDNS=no"
  tags: dns

- name: Clear /etc/resolv.conf
  shell: "echo > /etc/resolv.conf"
  tags:
    - dns

- name: Add search domain
  lineinfile:
    path: /etc/resolv.conf
    line: "{{ dns_search }}"
  tags: 
    - dns
  
- name: Add DNS servers
  lineinfile: 
    path: /etc/resolv.conf
    line: "{{ item }}"
    with_items: "{{ dns_nameservers }}"
  tags:
    - dns
  
- name: Add options
  lineinfile:
    path: /etc/resolv.conf
    line: "{{ dns_options }}"
  tags:
    - dns